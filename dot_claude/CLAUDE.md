# CLAUDE.md

## コア原則

- **事実から始める**: 推測で動かない。まずログ・エラー・スタックトレースを確認する。
- **根本解決**: 応急処置は禁止。根本原因を特定し、シニア水準で解決する。
- **最善策を探す**: ハック的な修正に逃げず、よりよい方法がないか立ち止まって考える。
- **シンプル・最小限**: 変更は可能な限り単純に。必要な箇所だけ変更し、過剰な設計・修正をしない。
- **一度見直す**: 実装後に一歩引いて全体を見直す。勢いで進めない。

## 進め方

- **プランファースト**: 設計や非自明なタスクはプランモードに入る。いきなりコードを書かない。
- **仕様書先行**: 実装前に詳細な仕様書を書く。何を作るか・どう作るかを明確にしてから手を動かす。
- **柔軟にリプラン**: 実装中に問題が起きたら無理に突き進まない。立ち止まって再度プランモードに入り、方針を見直す。

## 完了前の検証

タスクを完了とする前に、必ず動作確認を行う。「たぶん大丈夫」で終わらせない。

- **差分確認**: 必要に応じて main/master ブランチとの diff を確認し、意図しない変更が含まれていないことを確かめる。
- **テスト実行**: 関連するテストを実行し、全てパスすることを確認する。テストがなければ手動で動作確認する。
- **ログ・出力確認**: ビルドログ、ランタイムログ、コンソール出力を確認し、警告やエラーがないことを確かめる。
- **自己レビュー**: 変更全体を見直し、不要なデバッグコードや TODO が残っていないことを確認する。

## サブエージェント活用

メインコンテキストを清潔に保つため、サブエージェントを積極的に使う。

- **原則**: 調査・探索・分析はサブエージェントに委譲する。メインコンテキストに不要な情報を流し込まない。
- **1エージェント1タスク**: サブエージェントには単一の明確なタスクだけを渡す。複数の目的を混ぜない。
- **独立タスクは並列実行**: 依存関係のないタスクは複数のサブエージェントを同時に起動する。
- **結果は要約して受け取る**: サブエージェントの出力をそのまま展開せず、メインに必要な情報だけを簡潔にまとめる。

## MCP 利用方針（Context7 / DeepWiki）

このプロジェクトでは、MCP を以下の方針で使い分ける。

### 使い分け
- **Context7**: 外部ライブラリ / フレームワーク / API の最新仕様確認
  - 例: Next.js, React, Tailwind, Supabase, Prisma など
  - 用途: 実装方法、設定値、API 名、バージョン差分の確認
  - 外部ライブラリの実装・設定・コード生成時は原則使う
  - バージョン差がありそうな場合は、バージョンを明示して確認する
  - 必要に応じて `resolve-library-id` → `query-docs` の順で使う

- **DeepWiki**: GitHub リポジトリの構造・設計・既存実装の理解
  - 用途: ディレクトリ構成、認証フロー、各モジュールの役割、repo文脈でのQA
  - repo 調査時は原則使う
  - まず構造を確認し、必要箇所を読む
  - repo 固有の内容と一般的知識を混同しない

### 併用ルール（重要）
repo 固有の実装と外部仕様の両方が必要な場合は、**DeepWiki → Context7** の順で使う。

1. DeepWiki で repo の構造・既存実装を把握
2. Context7 で外部仕様を確認
3. repo 文脈に合わせて実装案を作る

### 判断の目安
- 「この repo / このコードベース」の話 → **DeepWiki**
- 「このライブラリ / API の使い方」の話 → **Context7**
- エラー原因が既存コード寄り → **DeepWiki**
- エラー原因が仕様・バージョン寄り → **Context7**

### 品質ルール
- 提案時は以下を分けて説明する
  - **repo 固有の事情**（DeepWiki）
  - **外部仕様**（Context7）
- バージョン差・非推奨 API・破壊的変更は明示する
- 不明な点は断定せず、「repo前提が不明」または「仕様の追加確認が必要」と明記する
