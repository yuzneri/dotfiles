# ============================================================
#  General
# ============================================================
set  -g  mouse on
set  -g  history-limit 10000
set  -g  base-index 1
setw -g  pane-base-index 1
set  -g  default-terminal "screen-256color"
set  -g  terminal-overrides 'xterm:colors=256'
set  -s  set-clipboard on

# ============================================================
#  Key Bindings – Copy Mode (vi style)
# ============================================================
setw -g mode-keys vi

# Scroll speed in copy-mode
bind-key -T copy-mode-vi WheelUpPane   send-keys -X -N 5 scroll-up
bind-key -T copy-mode-vi WheelDownPane send-keys -X -N 5 scroll-down

# Escape exits copy-mode
bind-key -T copy-mode-vi Escape send-keys -X cancel

# Auto-enter copy-mode on wheel scroll
bind-key -n WheelUpPane   if-shell -F -t = "#{pane_in_mode}" \
  "send-keys -X -N 5 scroll-up" "copy-mode -e; send-keys -X -N 5 scroll-up"
bind-key -n WheelDownPane if-shell -F -t = "#{pane_in_mode}" \
  "send-keys -X -N 5 scroll-down" "send-keys -X -N 5 scroll-down"

# ============================================================
#  Key Bindings – Pane Splitting
# ============================================================
bind-key \\ split-window -h -c '#{pane_current_path}'
bind-key |  split-window -h -c '#{pane_current_path}'
bind-key -  split-window -v -c '#{pane_current_path}'

# ============================================================
#  Status Bar
# ============================================================
set  -g  status on
set  -g  status-justify left
set  -g  status-interval 1
set  -g  status-style "bg=#080808,fg=#a8a8a8"
set  -g  status-left-length 60
set  -g  status-right-length 50

# -- Left: session name & host --------------------------------
set -g status-left "\
#{?client_prefix,\
#[fg=#1c1c1c]#[bg=#af87ff]#[bold] #S #[default],\
#[fg=#af87ff,bold] #S #[nobold]}\
#[fg=#585858]│ #[fg=#a8a8a8]#{host} #[fg=#585858]│"

# -- Centre: window list --------------------------------------
setw -g window-status-format         "#[fg=#767676] #I:#W "
setw -g window-status-current-format "#[fg=#080808,bg=#af87ff,bold] #I:#W #[default]"
setw -g window-status-bell-style     "fg=#1c1c1c,bg=#d75f5f,bold"
setw -g window-status-separator      "#[fg=#585858]│"

# -- Right: system stats & clock -------------------------------
set -g status-right "\
#(~/.config/tmux/cpu.sh) #[fg=#585858]│ \
#(~/.config/tmux/mem.sh) #[fg=#585858]│ \
#(~/.config/tmux/disk.sh) #[fg=#585858]│ \
#[fg=#767676]%m/%d #[fg=#a8a8a8]%H:%M#[default]"

# ============================================================
#  Pane Border
# ============================================================
set -g pane-border-status       bottom
set -g pane-border-style        "fg=#303030"
set -g pane-active-border-style "fg=#af87ff"

set -g pane-border-format "\
#{?pane_active,#[fg=#af87ff],#[fg=#767676]} #P \
#{?window_zoomed_flag,#[fg=#080808]#[bg=#af87ff]#[bold] ZOOM #[default],}\
#{?pane_in_mode,#[fg=#080808]#[bg=#d7af5f]#[bold] COPY #[default],}\
#{?pane_synchronized,#[fg=#080808]#[bg=#87d787]#[bold] SYNC #[default],}\
#[fg=#585858]│ \
#{?pane_active,#[fg=#d0d0d0],#[fg=#949494]}\
#(~/.config/tmux/short-path.sh #{pane_current_path}) \
#{?#{!=:#(cd #{pane_current_path} && git rev-parse --abbrev-ref HEAD 2>/dev/null),},\
#[fg=#585858]│ \
#{?pane_active,\
#(~/.config/tmux/git-branch.sh #{pane_current_path}),\
#[fg=#767676]#(cd #{pane_current_path} && git rev-parse --abbrev-ref HEAD 2>/dev/null)} ,\
}\
#[fg=#585858]│ \
#{?#{m:*sh,#{pane_current_command}},,\
#{?pane_active,#[fg=#d7af5f],#[fg=#767676]}▶ }\
#{?pane_active,#[fg=#d7af5f],#[fg=#767676]}#{pane_current_command}"

# ============================================================
#  Plugins (TPM)
# ============================================================
setenv -g TMUX_PLUGIN_MANAGER_PATH '$HOME/.tmux/plugins/'

# Auto-install TPM if missing
if "test ! -d ~/.tmux/plugins/tpm" \
  "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && \
    ~/.tmux/plugins/tpm/bin/install_plugins'"

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore       'on'
set -g @continuum-save-interval '5'

# Initialize TPM (keep at the very end)
run '~/.tmux/plugins/tpm/tpm'